## æ ‘å½¢æ•°ç»„ä»¥åŠæ€è·¯æ±‡æ€»å’Œä¾‹é¢˜

> #### [307. åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„å¯ä¿®æ”¹](https://leetcode-cn.com/problems/range-sum-query-mutable/)

## **ğŸ“æ€æƒ³ç†è§£**

> è¿™é‡Œæ˜¯å‚è€ƒ [ä¸‰å¶å§å§çš„è§£é¢˜æ€è·¯](https://leetcode-cn.com/problems/range-sum-query-mutable/solution/guan-yu-ge-lei-qu-jian-he-wen-ti-ru-he-x-41hv/)

é’ˆå¯¹ä¸åŒçš„é¢˜ç›®ï¼Œæˆ‘ä»¬æœ‰ä¸åŒçš„æ–¹æ¡ˆå¯ä»¥é€‰æ‹©ï¼ˆå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ•°ç»„ï¼‰ï¼š

- **æ•°ç»„ä¸å˜ï¼Œæ±‚åŒºé—´å’Œ**ï¼šã€Œå‰ç¼€å’Œã€ã€ã€Œæ ‘çŠ¶æ•°ç»„ã€ã€ã€Œçº¿æ®µæ ‘ã€
- **å¤šæ¬¡ä¿®æ”¹æŸä¸ªæ•°ï¼ˆå•ç‚¹ï¼‰**ï¼Œæ±‚åŒºé—´å’Œï¼šã€Œæ ‘çŠ¶æ•°ç»„ã€ã€ã€Œçº¿æ®µæ ‘ã€
- **å¤šæ¬¡ä¿®æ”¹æŸä¸ªåŒºé—´**ï¼Œè¾“å‡ºæœ€ç»ˆç»“æœï¼šã€Œå·®åˆ†ã€
- **å¤šæ¬¡ä¿®æ”¹æŸä¸ªåŒºé—´ï¼Œæ±‚åŒºé—´å’Œ**ï¼šã€Œçº¿æ®µæ ‘ã€ã€ã€Œæ ‘çŠ¶æ•°ç»„ã€**ï¼ˆçœ‹ä¿®æ”¹åŒºé—´èŒƒå›´å¤§å°ï¼‰**
- **å¤šæ¬¡å°†æŸä¸ªåŒºé—´å˜æˆåŒä¸€ä¸ªæ•°ï¼Œæ±‚åŒºé—´å’Œ**ï¼šã€Œçº¿æ®µæ ‘ã€ã€ã€Œæ ‘çŠ¶æ•°ç»„ã€**ï¼ˆçœ‹ä¿®æ”¹åŒºé—´èŒƒå›´å¤§å°ï¼‰**

:bookmark_tabs:**è§£é¢˜ç”¨æ³•é€‰æ‹©æ€æƒ³ï¼š**

> è¿™æ ·çœ‹æ¥ï¼Œã€Œçº¿æ®µæ ‘ã€èƒ½è§£å†³çš„é—®é¢˜æ˜¯æœ€å¤šçš„ï¼Œé‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯æ— è®ºä»€ä¹ˆæƒ…å†µéƒ½å†™ã€Œçº¿æ®µæ ‘ã€å‘¢ï¼Ÿ

ç­”æ¡ˆå¹¶ä¸æ˜¯ï¼Œè€Œä¸”æ°å¥½ç›¸åï¼Œåªæœ‰åœ¨æˆ‘ä»¬é‡åˆ°ç¬¬ 4 ç±»é—®é¢˜ï¼Œ**ä¸å¾—ä¸å†™ã€Œçº¿æ®µæ ‘ã€çš„æ—¶å€™**ï¼Œæˆ‘ä»¬**æ‰è€ƒè™‘çº¿æ®µæ ‘**ã€‚

å› ä¸º**ã€Œçº¿æ®µæ ‘ã€ä»£ç å¾ˆé•¿ï¼Œè€Œä¸”å¸¸æ•°å¾ˆå¤§**ï¼Œå®é™…`è¡¨ç°ä¸ç®—å¾ˆå¥½`ã€‚æˆ‘ä»¬**åªæœ‰åœ¨ä¸å¾—ä¸ç”¨çš„æ—¶å€™æ‰è€ƒè™‘ã€Œçº¿æ®µæ ‘ã€**ã€‚

æ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥æŒ‰è¿™æ ·çš„ä¼˜å…ˆçº§è¿›è¡Œè€ƒè™‘ï¼š

- **ç®€å•æ±‚åŒºé—´å’Œ**ï¼Œç”¨**ã€Œå‰ç¼€å’Œã€**
- **å¤šæ¬¡å°†æŸä¸ªåŒºé—´å˜æˆåŒä¸€ä¸ªæ•°**ï¼Œç”¨**ã€Œçº¿æ®µæ ‘ã€**
- **å…¶ä»–æƒ…å†µï¼Œç”¨ã€Œæ ‘çŠ¶æ•°ç»„ã€**

:bookmark_tabs:**æ•°çŠ¶æ•°ç»„æ¨¡æ¿ä»¥åŠä½¿ç”¨ï¼Ÿæ€æƒ³ç†è§£ï¼Ÿ**

æœ¬é¢˜æ˜¾ç„¶å±äºç¬¬ 2 ç±»é—®é¢˜ï¼š**å¤šæ¬¡ä¿®æ”¹æŸä¸ªæ•°ï¼Œæ±‚åŒºé—´å’Œã€‚**

æˆ‘ä»¬ä½¿ç”¨**ã€Œæ ‘çŠ¶æ•°ç»„ã€**è¿›è¡Œæ±‚è§£ã€‚

**ã€Œæ ‘çŠ¶æ•°ç»„ã€æœ¬èº«æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯è¦ææ‡‚å…¶ä¸ºä»€ä¹ˆå¯ä»¥è¿™æ ·ã€ŒæŸ¥è¯¢ã€&ã€Œæ›´æ–°ã€è¿˜æ˜¯æ¯”è¾ƒå›°éš¾çš„ï¼ˆç‰¹åˆ«æ˜¯ä¸ºä»€ä¹ˆå¯ä»¥è¿™æ ·æ›´æ–°ï¼‰ï¼Œå¾€å¾€éœ€è¦ä»ã€ŒäºŒè¿›åˆ¶åˆ†è§£ã€è¿›è¡Œå‡ºå‘ç†è§£ã€‚**

å› æ­¤æˆ‘è¿™é‡Œç›´æ¥æä¾›ã€Œæ ‘çŠ¶æ•°ç»„ã€çš„ä»£ç ï¼Œå¤§å®¶å¯ä»¥ç›´æ¥å½“åšæ¨¡æ¿èƒŒè¿‡å³å¯ã€‚

**:book: lowbit**

- æ ‘çŠ¶æ•°ç»„åŸºæœ¬æ“ä½œ `lowbit(x)` æ˜¯`è¿”å› x çš„æœ€åä¸€ä½1åŠå…¶åé¢0æˆ–ç©ºç»„æˆçš„äºŒè¿›åˆ¶æ•°`
- ä¾‹å¦‚ `lowbit(10)`  10 = $(1010)_2$ ä»å³è¾¹æ•°ç¬¬ä¸€æ¬¡é‡åˆ°1å¾€å³çš„æ‰€æœ‰çš„ä½ç»„æˆçš„äºŒè¿›åˆ¶æ•° è¿™é‡Œ è¿”å›çš„å°±æ˜¯2.

> å¦‚ä½•è®¡ç®—ï¼Ÿ

`x & -x`   ===>   `x & (~x + 1)`

```java
x  =  1010 ... 100 ... 0
~x =  0101 ... 011 ... 1
~x+1= 0101 ... 100 ... 0
```

è¿™æ ·ä¸€æ¥å°±å¯ä»¥è®¡ç®—`lowbit(x)`äº†

```java
// ä¸Šæ¥å…ˆæŠŠä¸‰ä¸ªæ–¹æ³•å†™å‡ºæ¥
{
    int[] tree;
    int lowbit(int x){
        return x & -x;
    }
    // æŸ¥è¯¢å‰ç¼€å’Œçš„æ–¹æ³•
    int query(int x){
        int res = 0 ;
        for (int i = x ; i > 0;i -= lowbit(i))res += tree[i];
        return res;
    }
    
    // åœ¨æ ‘çŠ¶æ•°ç»„ x ä½ç½®ä¸­å¢åŠ å€¼ u
    void add(int x ,int u ){
        for (int i = x ; i<= n;i+= lowbit(i))tree[i] += u;
    }
    
}
// åˆå§‹åŒ– æ ‘çŠ¶æ•°ç»„ ï¼Œè¦é»˜è®¤æ•°ç»„æ˜¯ä» 1 å¼€å§‹çš„
{
    for (int i = 0 ;i< n;i++)add(i+1,nums[i]);
}
// æ ‘çŠ¶æ•°ç»„çš„ä½¿ç”¨ 
{
    void update (int i ,int val){
        // åŸæœ‰çš„å€¼æ˜¯ nums[i] ,è¦ä½¿å¾— ä¿®æ”¹ä¸º val éœ€è¦å¢åŠ  val - nums[i]
        add(i + 1 , val - nums[i]);
        nums[i] = val;
    }
    
    int sumRange(int l , int r ){
        return query(r + 1) - query(l);
    }
}
```

## :bookmark_tabs: **åŸºæœ¬åŸç†ç†è§£ä»¥åŠæ‰©å±•**

===> å·®åˆ†

===> å·®åˆ† + å…¬å¼

===> ä¾‹é¢˜

> **æ ‘çŠ¶æ•°ç»„ èƒ½å¹²ä»€ä¹ˆï¼Ÿ**

- **å¿«é€Ÿæ±‚è§£å‰ç¼€å’Œ** $O(logN)$
- **å•ç‚¹æ“ä½œä¿®æ”¹æŸä¸€ä¸ªæ•°$O(logN)$**

æ ‘çŠ¶æ•°ç»„ æ˜¯ä¸€ä¸ªåŸºäºäºŒè¿›åˆ¶çš„æ€æƒ³æ¥å®ç°çš„

![image-20220404114518967](../img/1.png)

![image-20220404115252914](../img/2.png)

![image-20220404120334178](../img/3.png)

> å¦‚ä½•é€šè¿‡å­èŠ‚ç‚¹æ‰¾åˆ°çˆ¶èŠ‚ç‚¹

![image-20220404122243490](../img/4.png)

## :bookmark_tabs:æ ‘çŠ¶æ•°ç»„æ‰©å±•ä»£ç æ¨¡æ¿

> æ ‘çŠ¶æ•°ç»„æ‰©å±•ä»£ç æ¨¡æ¿

![image-20220404134123295](../img/9.png)

![image-20220404134038793](../img/8.png)

![image-20220404133957866](../img/7.png)

![image-20220404133850150](../img/6.png)

## :bookmark_tabs: æ€»ç»“

- **å•ç‚¹ä¿®æ”¹ï¼Œå•ç‚¹æŸ¥è¯¢** add(x,k); ask(x) - ask(x - 1);
- **å•ç‚¹ä¿®æ”¹ï¼ŒåŒºé—´æŸ¥è¯¢** add(x,k); ask(r) - ask(l - 1);
- **åŒºé—´ä¿®æ”¹ï¼Œå•ç‚¹æŸ¥è¯¢** add(l,k); add(r + 1,-k); arr[x] + ask(x);
- **åŒºé—´ä¿®æ”¹ï¼ŒåŒºé—´æŸ¥è¯¢** ä¸€èˆ¬è¿™ç§é¢˜é‡‡ç”¨çº¿æ®µæ ‘æ¯”è¾ƒå¥½

```java
/***
 * @authorï¼š Alascanfu
 * @date ï¼š Created in 2022/4/4 16:24
 * @descriptionï¼š æ ‘å½¢æ•°ç»„æ¨¡æ¿
 * @modified Byï¼š Alascanfu
 **/
public class TreeArray {
    int n ;
    int [] tree;
    int [] nums;
    int lowbit(int x){
        return x & -x;
    }
    
    void add(int x , int u){
        for (int i = x ; i<= n;i+=lowbit(i))tree[i]+=u;
    }
    
    int query(int x){
        int res = 0;
        for (int i = x; i > 0;i-=lowbit(i))res += tree[i];
        return res;
    }
    
    public void init(int[] nums){
        this.n = nums.length;
        this.nums = nums;
        tree = new int[n+1];
        for (int i = 0 ; i< n;i++)add(i+1,nums[i]);
    }
    
    /**
     * åŠŸèƒ½æè¿°
     * å•ç‚¹ä¿®æ”¹
     * @date 2022/4/4
     * @author Alascanfu
     */
    void updateOneNum(int index ,int val ){
        add(index+1,val - nums[index]);
        nums[index] = val;
    }
    
    /**
     *åŠŸèƒ½æè¿°
     * å•ç‚¹æŸ¥è¯¢
     * @date 2022/4/4
     *  @author Alascanfu
     */
    int queryOneNum(int index){
        return query(index + 1) - query(index);
    }
    
    /**
     * åŠŸèƒ½æè¿°
     * åŒºé—´æŸ¥è¯¢
     * @date 2022/4/4
     * @author Alascanfu
     */
    int sumRanges(int left ,int right ){
        return query(right + 1) - query(left);
    }
    
    /**
     *åŠŸèƒ½æè¿°
     * åŒºé—´ä¿®æ”¹
     * @date 2022/4/4
     *  @author Alascanfu
     */
    void updateIntervalChanges(int left ,int right ,int val){
        add(left+1,val);
        add(right+1 ,-val);
    }
}
```

