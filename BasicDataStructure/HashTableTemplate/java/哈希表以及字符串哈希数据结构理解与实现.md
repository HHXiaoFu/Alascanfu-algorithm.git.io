# :book: å“ˆå¸Œè¡¨ä»¥åŠå­—ç¬¦ä¸²å“ˆå¸Œæ–¹æ³•ç†è§£ä¸å®ç°

![image-20220511235237120](./HashTable01.png)

## :bookmark_tabs: å“ˆå¸Œè¡¨å­˜å‚¨ç»“æ„

### :bookmark: å¼€æ”¾å¯»å€æ³• ï¼ˆå¸¸ç”¨ï¼‰

> **åªéœ€è¦å¼€ä¸€ä¸ª é¢˜ç›®ç»™å®šæ•°æ®èŒƒå›´çš„ 2 ~ 3å€ çš„æ•°ç»„æ¥è¿›è¡Œå­˜å‚¨æ˜ å°„**
>
> **å¦‚ä½•å¤„ç†å†²çªï¼Ÿ**

å¦‚æœå‡ºç°å†²çªåˆ™æŒ‰é¡ºåºæ‰¾åˆ°æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªæœªå†²çªä½ç½®è¿›è¡Œå­˜å‚¨

![image-20220512153307581](./HashTable03.png)

**Yæ€»æ¨¡æ¿å®ç°**

```java
import java.io.*;
import java.util.*;

class Main{
    static int N = 200003;
    static int NULL = 0x3f3f3f;
    static int[] h;
    static int idx ;
    
    static void init(){
        h = new int[N];
        Arrays.fill(h,0x3f3f3f);
    }
    
    static int find(int x){
        int k = (x % N + N ) % N;
        while (h[k] != 0x3f3f3f && h[k] != x){
            k++;
            if (k == N )k = 0;
        }
        return k;
    }
    
    public static void main(String[] args )throws IOException{
        init();
        InputStreamReader in = new InputStreamReader(System.in);
        BufferedReader br = new BufferedReader(in);
        int n = Integer.parseInt(br.readLine());
        while (n -- > 0){
            String[] params = br.readLine().split(" ");
            String op = params[0];
            if (op.equals("I")){
                int x = Integer.parseInt(params[1]);
                h[find(x)] = x;
            }else {
                int x = Integer.parseInt(params[1]);
                System.out.println(h[find(x)] == x ? "Yes" : "No");
            }
        }
        
    }
}
```

### :bookmark: æ‹‰é“¾æ³•ï¼ˆå¸¸ç”¨ï¼‰

> **éœ€è¦å¼€ä¸€ä¸ª $10^5$ çš„æ•°ç»„æ¥è¿›è¡Œå­˜å‚¨æ˜ å°„ä½œä¸ºæ§½ h[N]**
>
> **åŒæ—¶ä¹Ÿéœ€è¦å¼€ä¸€ä¸ªé“¾è¡¨æ‰€ç”¨çš„æ•°æ®ç»“æ„ç©ºé—´ å³ e[N] , ne[N]**

> **å¦‚ä½•æ¥å¤„ç†å†²çªï¼Ÿ**

h(11) = 3 æ¯ä¸€ä¸ªä½ç½®å¯ä»¥å½“åšä¸€ä¸ªæ§½ å°†å…¶æ‹‰ä¸‹æ¥ æ„å»ºä¸€ä¸ªæ•°ä¸º 11

![image-20220512145350281](./HashTable02.png)

**å“ˆå¸Œè¡¨æ˜¯ä¸€ä¸ªæœŸæœ›ç®—æ³•â€”â€”æ¯ä¸€ä¸ªæ‹‰é“¾éƒ½å¯ä»¥çœ‹æˆå¸¸æ•°é•¿åº¦â€”â€”ä¸€èˆ¬æƒ…å†µä¸‹æ—¶é—´å¤æ‚åº¦å¯ä»¥çœ‹åšä¸º O(1)**

> **éœ€è¦å®Œæˆçš„æ“ä½œ**
>
> æ·»åŠ ä¸€ä¸ªæ•°
>
> æŸ¥è¯¢ä¸€ä¸ªæ•°

> æ‰¾ > $10^5$ çš„ç¬¬ä¸€ä¸ªè´¨æ•°

```java
	for (int i = 100000 ; ; i++){
            boolean flag = true ;
            for (int j = 2 ; j * j <= i ; j++){
                if (i % j == 0){
                    flag = false;
                    break;
                }
            }
            if (flag){
                System.out.print(i);
                break;
            }
        }
```

**Yæ€»æ¨¡æ¿å®ç°**

[840. æ¨¡æ‹Ÿæ•£åˆ—è¡¨ - AcWingé¢˜åº“](https://www.acwing.com/problem/content/842/)

```java
import java.io.*;
import java.util.*;

class Main{
    static int N = 100003;
    static int[] h,e,ne;
    static int idx ;
    
    static void init(){
        h = new int[N];
        e = new int[N];
        ne = new int[N];
        idx = 0;
        Arrays.fill(h,-1);
    }
    
    static void add(int x){
        int k = (x % N + N) % N;
        e[idx] = x;
        ne[idx] = h[k];
        h[k] = idx++;
    }
    
    static boolean contains(int x){
        int k = (x % N + N ) % N;
        for (int i = h[k] ; i != -1 ;i = ne[i]){
            if (x == e[i]){
                return true;
            }
        }
        return false;
    }
    
    public static void main(String[] args )throws IOException{
        init();
        InputStreamReader in = new InputStreamReader(System.in);
        BufferedReader br = new BufferedReader(in);
        int n = Integer.parseInt(br.readLine());
        while (n -- > 0){
            String[] params = br.readLine().split(" ");
            String op = params[0];
            if (op.equals("I")){
                int x = Integer.parseInt(params[1]);
                add(x);
            }else {
                int x = Integer.parseInt(params[1]);
                System.out.println(contains(x) == true ? "Yes" : "No");
            }
        }
        
    }
}
```

## :bookmark_tabs: å­—ç¬¦ä¸²å“ˆå¸Œæ–¹å¼

### :bookmark: å­—ç¬¦ä¸²å‰ç¼€å“ˆå¸Œæ³•

![image-20220512155138254](./HashTable04.png)

![image-20220512155501927](./HashTable05.png)

**é¦–å…ˆéœ€è¦æŠŠ å­—ç¬¦ä¸²çœ‹åšä¸ºä¸€ä¸ª P è¿›åˆ¶çš„æ•° ï¼Œå°† P è¿›åˆ¶çš„æ•° è½¬åŒ–ä¸º åè¿›åˆ¶çš„æ•°ï¼Œæœ€å å¯¹ä¸€ä¸ªè¾ƒå°çš„æ•° Q å–æ¨¡**

```txt
æ€è·¯ï¼š
ç”¨å‰ç¼€å’Œçš„æ€æƒ³ï¼Œæ±‚å‡ºå‰ç¼€å­—ç¬¦ä¸²çš„å“ˆå¸Œå€¼
ä¸¾ä¾‹è¯´æ˜ï¼š

"ABCDEFGHI"
 123456789   (ä¸‹æ ‡)
     L   R
å­—ç¬¦ä¸²"A"çš„    å“ˆå¸Œå€¼ä¸º p^0+A
å­—ç¬¦ä¸²"AB"     å“ˆå¸Œå€¼ä¸º p^1+A + p^0+B
å­—ç¬¦ä¸²"ABC"    å“ˆå¸Œå€¼ä¸º p^2+A + p^1+B + C
å­—ç¬¦ä¸²[1,L-1]çš„å“ˆå¸Œå€¼ä¸º p^3+A + p^2+B + p^1+C + p^0+D
å­—ç¬¦ä¸²[1,R]  çš„å“ˆå¸Œå€¼ä¸º p^8+A + p^7+B +  ...  + P^0+I     
```

**:books:å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š**

![image-20220512155712075](./HashTable06.png)

> **ç»éªŒå€¼æ€»ç»“**

**å‡å®š**

**P = 131 æˆ– 13331**

**Q = $2^{64}$ æ—¶ 99.99%ä¸ä¼šå‘ç”Ÿå†²çª**

![image-20220512160547379](./HashTable07.png)

> **é‚£ä¹ˆå¦‚ä½•æ±‚[L,R]å­—ç¬¦ä¸²çš„å“ˆå¸Œå€¼å‘¢ï¼Œæ ¹æ®å‰ç¼€å’Œçš„æ€æƒ³ï¼Œå°±æ˜¯h[R] - h[L-1] (h[R]è¡¨ç¤ºä»[1,R]çš„å­—ç¬¦ä¸²å“ˆå¸Œå€¼)ï¼Ÿ**

ä½†æ˜¯å‘ç°`h[R]`ä»`[1,L-1]`è¿™ä¸€æ®µ`left`ï¼Œæ¯ä¸ªæ•°éƒ½æ¯”`right`è¿™ä¸€æ®µå¤šä¹˜äº† $p^{R-(L-1)}$

æ‰€ä»¥å­—ç¬¦ä¸²ä»`[L,R]`çš„å“ˆå¸Œå€¼ä¸º

$h[R] - h[L - 1] * p^{R-(L-1)} = h[R] - h[L - 1] * p^{R-L+1} $

**ğŸ“– Yæ€»ä»£ç å®ç°ï¼š**

```java
import java.io.*;
import java.util.*;

class Main{
    static int P = 131;
    static int N = 100010;
    static char[]str ;
    static long[] h , p;
    
    static void init(){
        str = new char[N];
        h = new long[N];
        p = new long[N];
        p[0] = 1;
    }
    
    static boolean checkIsEquals(int l1 , int r1 , int l2 ,int r2 ){
        return h[r1] - h[l1-1] * p[r1 - l1 + 1] == h[r2] - h[l2-1] * p[r2 - l2 + 1];
    }
    
    public static void main(String[] args )throws IOException{
        init();
        InputStreamReader in = new InputStreamReader(System.in);
        BufferedReader br = new BufferedReader(in);
        String[] params = br.readLine().split(" ");
        int n = Integer.parseInt(params[0]);
        int m = Integer.parseInt(params[1]);
        String s = br.readLine();
        for (int i = 1 ; i <= s.length();i++){
            str[i] = s.charAt(i-1);
        }
        
        for (int i = 1 ; i<= n ; i++){
            p[i] = p[i-1] * P;
            h[i] = h[i-1] *P + str[i];
        }
        
        while (m -- >0 ){
            params = br.readLine().split(" ");
            int l1 = Integer.parseInt(params[0]);int r1 = Integer.parseInt(params[1]);
            int l2 = Integer.parseInt(params[2]);int r2 = Integer.parseInt(params[3]);
            System.out.println(checkIsEquals(l1,r1,l2,r2) == true ? "Yes" : "No");
        }
    }
}
```

