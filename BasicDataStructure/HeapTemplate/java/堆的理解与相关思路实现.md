# ğŸ“– å †çš„ç†è§£ä¸ç›¸å…³æ€è·¯å®ç°

## :bookmark_tabs: å¦‚ä½•æ‰‹æ’•ä¸€ä¸ªå †ï¼Ÿ

> **å †æ”¯æŒçš„æ•°æ®æ“ä½œ**

- **æ’å…¥ä¸€ä¸ªæ•°**
- **æ±‚è¿™ä¸ªé›†åˆä¸­çš„æœ€å°å€¼**
- **åˆ é™¤æœ€å°å€¼**
- **åˆ é™¤ä»»æ„ä¸€ä¸ªå…ƒç´ **
- **ä¿®æ”¹ä»»æ„ä¸€ä¸ªå…ƒç´ **

![image-20220510155144100](./Heap00.png)

## :bookmark_tabs: å †çš„ç»“æ„

**å †å¯ä»¥çœ‹åšæ˜¯ä¸€æ£µå®Œå…¨äºŒå‰æ ‘**

>  **ä»¥å°æ ¹å †ä¸ºä¾‹**

**æ¯ä¸€ä¸ªç‚¹éƒ½æ˜¯å°äºç­‰äºå·¦å³å„¿å­èŠ‚ç‚¹çš„**

:books: **æ³¨æ„ï¼šç”±æ­¤å°±å¯ä»¥å¾—å‡ºæ ¹èŠ‚ç‚¹å°±æ˜¯å½“å‰å †çš„æœ€å°å€¼**

## :bookmark_tabs: å †çš„å­˜å‚¨

**ä¸€ç§å…¨æ–°çš„å­˜å‚¨æ–¹å¼ â€”â€” åˆ©ç”¨ä¸€ä¸ªä¸€ç»´æ•°ç»„è¿›è¡Œå­˜å‚¨**

![image-20220510150610386](./Heap01.png)

ä¸€å·èŠ‚ç‚¹æ˜¯æ ¹èŠ‚ç‚¹â€”â€”

- X çš„`å·¦å„¿å­`ä¸º `2X`
- X çš„`å³å„¿å­`ä¸º `2X + 1`

![image-20220510153642411](./Heap02.png)

**down(x) ä¸ up(x) æ“ä½œ**

### :bookmark: æ“ä½œå®ç°

- `heap[]` ä»£è¡¨å †
- `size` ä»£è¡¨å †çš„å¤§å°

> **æ’å…¥ä¸€ä¸ªæ•°**

```txt
heap[++size] = x;
up(size); // ä¸Šç§»æ“ä½œ
```

> **è·å–å †ä¸­çš„æœ€å°å€¼**

```txt
heap[1] // è¿”å›æœ€å°å€¼
```

> **åˆ é™¤æ“ä½œ --> å®é™…ä¸Šæ˜¯å°†heap çš„`æœ€åä¸€ä¸ªå…ƒç´  æŠŠç¬¬ä¸€ä¸ªå…ƒç´ è¦†ç›–`æ‰ ç„¶å `size --` å†è¿›è¡Œä¸€æ¬¡ `down(1)` æ“ä½œå³å¯**

```txt
heap[1] = heap[size--];
down(1);
```

> **åˆ é™¤ä»»æ„ä¸€ä¸ªå…ƒç´  åŒç†**

```txt
heap[k] = heap[size--];
down(k); up(k);
```

> **ä¿®æ”¹ä»»æ„ä¸€ä¸ªå…ƒç´ **

```txt
heap[k] = x ;
down(k);
up(k);
```

> **down(int u )**

```txt
static void down(int u ){
    int t = u ;
    if ( u * 2 <= size && h[u * 2] < h[t])t = u * 2;
    if (u * 2 + 1 <= size && h[u * 2 + 1] < h[t]) t = u * 2 + 1;
    if (u != t){
        int tmp = h[t];
        h[t] = h[u];
        h[u] = tmp;
        down(t);
    }
}
```



### :bookmark: å»ºå † O(n) æ€è·¯ç†è§£

![image-20220510160343893](./Heap03.png)

## :bookmark_tabs: å †æ’åº

[838. å †æ’åº - AcWingé¢˜åº“](https://www.acwing.com/problem/content/840/)

```java
import java.io.*;
import java.util.*;
class Main{
    static int N = 100010;
    static int[] h ;
    static int size ;
    
    static void init(){
        h = new int[N];
        size = 0 ;
    }
    
    static void down(int u ){
        int t = u ;
        if ( u * 2 <= size && h[u * 2] < h[t])t = u * 2;
        if (u * 2 + 1 <= size && h[u * 2 + 1] < h[t]) t = u * 2 + 1;
        if (u != t){
            int tmp = h[t];
            h[t] = h[u];
            h[u] = tmp;
            down(t);
        }
    }
    
    public static void main(String[] args )throws IOException{
        init();
        InputStreamReader in = new InputStreamReader(System.in);
        BufferedReader br = new BufferedReader(in);
        String[] params = br.readLine().split(" ");
        int n = Integer.parseInt(params[0]);
        int m = Integer.parseInt(params[1]);
        params = br.readLine().split(" ");
        for (int i = 1; i <= n; i++){
            h[i] = Integer.parseInt(params[i-1]);
        }
        size = n;
        
        for (int i = n / 2 ; i>0;i--){
            down(i);
        }
        while (m -- > 0){
            System.out.print(h[1] + " ");
            h[1] = h[size--];
            down(1);
        }
    }
}
```

## :bookmark_tabs: å †çš„æ„å»ºï¼ˆæ”¯æŒä¸Šè¿°äº”ç§æ“ä½œï¼‰

![image-20220510170257302](./Heap04.png)

[839. æ¨¡æ‹Ÿå † - AcWingé¢˜åº“](https://www.acwing.com/problem/content/841/)

> **éš¾ç‚¹åœ¨äºåˆ é™¤ä¸ä¿®æ”¹æ“ä½œæ—¶**

**è¿™é‡Œçš„ k ä»£è¡¨çš„æ˜¯ç¬¬ k ä¸ªæ’å…¥çš„æ•°å€¼**ï¼Œéœ€è¦**åˆ©ç”¨ ä¸¤ä¸ªæ•°ç»„æ¥è¿›è¡Œç»´æŠ¤å¿«é€Ÿæ‰¾åˆ°ç¬¬ k ä¸ªæ’å…¥çš„å…ƒç´ æ˜¯ä»€ä¹ˆ** ï¼Œå…¶ä¸­ï¼š

- `ph[k]` ä»£è¡¨çš„æ˜¯ ç¬¬ k ä¸ªæ’å…¥å…ƒç´ åœ¨å †ä¸­çš„ä¸‹æ ‡æ˜¯å¤šå°‘ 
- `hp[k]` ä»£è¡¨çš„æ˜¯ è¯¥ä¸‹æ ‡ä¸º k çš„ç‚¹æ˜¯ç¬¬å‡ ä¸ªæ’å…¥çš„ç‚¹

> **è¯´ç™½äº†éš¾ç‚¹åœ¨äº heap_swap(int u1 , int u2)**

```java
static void heap_swap(int u1 , int u2){
    // å…ƒç´ æ‰€åœ¨å †ä½ç½®çš„ä¸‹æ ‡è¿›è¡Œäº¤æ¢
    swap(ph,hp[u1] , hp[u2]);
    // æ’å…¥çš„ç¬¬å‡ ä¸ªç‚¹å€¼ è¿›è¡Œäº¤æ¢
    swap(hp,u1,u2);
    // å€¼äº¤æ¢
    swap(h,u1,u2);
}
    
static void swap(int[] n,int a , int b ){
    int c = n[a] ;
    n[a] = n[b] ;
    n[b] = c;
}
```

> **insert(int x)**

```java
static void insert(int x){
    h[++size] = x;
    ph[++m] = size;
    hp[size] = m;
    up(size);
}
```

> **getMin() **

```java
static int getMin(){
    return h[1];
}
```

> **deleMin() And delete(int k )**

```java
static void deleteMin(){
    heap_swap(1,size);
    size--;
    down(1);
}
    
static void delete(int k){
    k = ph[k];
    heap_swap(k,size);
    size--;
    down(k);
    up(k);
}
```

> **modify(int k , int x)**

```java
static void modify(int k ,int x){
   h[ph[k]] = x;
   down(ph[k]);
   up(ph[k]);
}
```

> **down(int u ) And up(int u)**

```java
static void down(int u ){
    int t = u;
    if (2 * u <= size && h[t] > h[2 * u])t = 2 * u;
    if (2 * u + 1 <= size && h[t] > h[2 * u + 1]) t =2 * u + 1;
    if (t != u){
        heap_swap(t,u);
        down(t);
    }
}
    
static void up(int u){
    if (u / 2 > 0 && h[u / 2] > h[u]){
        heap_swap(u/2 ,u);
        up(u/2);
    }
}
```

> **æ€»ç»“**

```java
import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;

/***
 * @authorï¼š Alascanfu
 * @date ï¼š Created in 2022/5/10 19:04
 * @descriptionï¼š Heap Structure
 * @modified Byï¼š Alascanfu
 **/
class Main {
    static int N = 100010;
    // h[]ä»£è¡¨å †ç©ºé—´
    // ph[k]ä»£è¡¨ç¬¬ k ä¸ªæ’å…¥çš„å…ƒç´ æ‰€å¤„å †ä¸­çš„ä½ç½®ä¸‹æ ‡
    // hp[k] ä»£è¡¨çš„æ˜¯å †ä¸­ä¸‹æ ‡ä¸º k çš„å…ƒç´ æ˜¯ç¬¬å‡ ä¸ªæ’å…¥å †ä¸­çš„
    static int[] h ,ph , hp;
    
    // size ä»£è¡¨çš„å †çš„å¤§å°
    // m ä»£è¡¨çš„æ˜¯å½“å‰æ’å…¥çš„æ˜¯ç¬¬å‡ ä¸ªå…ƒç´ 
    static int size , m;
    
    // init
    static void init(){
        h = new int[N];
        ph = new int[N];
        hp = new int[N];
        size = 0 ;
        m = 0;
    }
    
    static void insert(int x){
        h[++size] = x;
        ph[++m] = size;
        hp[size] = m;
        up(size);
    }
    
    static int getCnt(){
        return h[1];
    }
    
    static void deleteMin(){
        heap_swap(1,size);
        size--;
        down(1);
    }
    
    static void delete(int k ){
        k = ph[k];
        heap_swap(k,size);
        size--;
        up(k);down(k);
    }
    
    static void modify(int k , int x){
        h[ph[k]] = x;
        up(ph[k]);down(ph[k]);
    }
    
    // heap_swap
    static void heap_swap(int u1 , int u2){
        // äº¤æ¢å› å€¼æ”¹å˜çš„ ä½ç½®æŒ‡é’ˆ ä»¥åŠ æ’å…¥æ—¶æŒ‡é’ˆ
        swap(ph,hp[u1],hp[u2]);
        swap(hp,u1,u2);
        // å †ä½ç½®ä¸‹æ ‡ä¸º u1 å’Œ u2 çš„å€¼è¿›è¡Œäº¤æ¢
        swap(h,u1,u2);
    }
    
    static void swap(int[]arr , int a , int b){
        int tmp = arr[a];
        arr[a] = arr[b];
        arr[b] = tmp;
    }
    
    static void down(int u){
        int t = u ;
        if (2 * u <= size && h[t] > h[2 * u]){
            t = 2 * u;
        }
        if (2 * u + 1 <= size && h[t] > h[2 * u + 1]){
            t = 2 * u + 1;
        }
        if (t != u){
            heap_swap(u , t);
            down(t);
        }
    }
    
    static void up(int u ){
        int t = u ;
        if (u / 2 > 0 && h[u/2] > h[t]){
            heap_swap(u/2 ,t);
            up(u/2);
        }
    }
    
    public static void main(String[] args) throws IOException {
        init();
        InputStreamReader in = new InputStreamReader(System.in);
        BufferedReader br = new BufferedReader(in);
        int n = Integer.parseInt(br.readLine());
        while (n -- > 0){
            String[] params = br.readLine().split(" ");
            String operate = params[0];
            if (operate.equals("I")){
                int x = Integer.parseInt(params[1]);
                insert(x);
            }else if (operate.equals("PM")){
                System.out.println(getCnt());
            }else if (operate.equals("DM")){
                deleteMin();
            }else if (operate.equals("D")){
                int k = Integer.parseInt(params[1]);
                delete(k);
            }else if (operate.equals("C")){
                int k = Integer.parseInt(params[1]);
                int x = Integer.parseInt(params[2]);
                modify(k,x);
            }
        }
    }
}

```

